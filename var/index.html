<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Vector Autoregression (VAR) of Longitudinal Sleep and Self-report Mood Data | Jeff Brozena</title> <meta name="author" content="Jeff Brozena"/> <meta name="description" content=""/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/favicon.ico"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://brozena.net/var/"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <d-front-matter> <script async type="text/json">{
      "title": "Vector Autoregression (VAR) of Longitudinal Sleep and Self-report Mood Data",
      "description": "",
      "published": "",
      "authors": [
        {
          "author": "Jeff Brozena",
          "authorURL": "",
          "affiliations": [
            {
              "name": "Penn State University",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <body class="fixed-top-nav"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://brozena.net/">Jeff Brozena</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="nav-item "> <a class="nav-link" href="/gallery/">Gallery</a> </li> <li class="nav-item "> <a class="nav-link" href="/now/">Now</a> </li> </ul> </div> </div> </nav> </header> <div class="post distill"> <d-title> <h1>Vector Autoregression (VAR) of Longitudinal Sleep and Self-report Mood Data</h1> <p></p> </d-title> <d-byline></d-byline> <d-article> <p>This is an exploratory N-of-1 analysis involving four years of my own sleep data captured via the Oura Ring, a consumer-grade sleep tracking device, and my self-reported mood data logged via eMood Tracker for iOS. After assessing the data for stationarity and computing the appropriate lag-length selection, I fit a vector autoregressive (VAR) model and performed Granger causality tests to assess causal mechanisms within this multivariate time series. <strong>Oura’s nightly sleep quality score was shown to Granger-cause presence of depressed and anxious moods using a VAR(2) model.</strong></p> <h2 id="introduction">Introduction</h2> <p>Long-term self-management of chronic illnesses such as bipolar disorder require persistent awareness of illness state over long periods of time and at varying time scales <d-cite key="murnaneSelfmonitoring2016"></d-cite><d-cite key="morton2018TakingBackReins"></d-cite><d-cite key="majid2022ExploringSelftrackingPractices"></d-cite>. Remaining consistently aware of key indicators signaling the onset of a chronic condition allow individuals a chance at early intervention to reduce the severity of a given episode. For example, an individual may modify behavior, engage their health practitioners, or adjust medication dosage. Bipolar disorder is an illness that often degrades an individual’s self-awareness and capacity for self-monitoring during symptomatic periods.</p> <p>In the context of this specific illness, a volume of prior work has demonstrated the vital role of sleep in order to promote mood stability and prevent symptomatic episodes <d-cite key="harveySleep2009"></d-cite><d-cite key="murrayCircadian2010"></d-cite><d-cite key="gruberSleep2011"></d-cite>. Although the particulars of this topic fall beyond the scope of this paper, these nuanced relationships may in fact be self-reinforcing and bidirectional — poor sleep may lead to episodic onset, which may also lead to worsening (or shortening) sleep bouts.</p> <p>Given the importance of sleep in the ongoing management of this illness, accurate consumer-grade alternatives to polysomnography (considered the gold standard of sleep tracking) have emerged over the last few years. Comparatively inexpensive sleep tracking technologies like the Oura Ring have dramatically improved the quality of information that can inform these self-monitoring activities. Objective sensor-based tracking technology can be complemented with subjective self-report measures in order to form a more complete picture of physical and mental health across time. Given the aforementioned interplay of sleep and mood, this combination of subjective and objective tracking creates the possibility of longitudinal analysis — and potentially deepens one’s capacity for self-awareness.</p> <p>Following four years of consistent sleep and mood tracking, I wanted to interpret the data I had collected to quantify what I had intuited: that certain mood states could be understood (and potentially even predicted) by recent sleep trends. This intuition has been demonstrated quantitatively in existing literature <d-cite key="boseVector2017"></d-cite><d-cite key="moshePredicting2021"></d-cite><d-cite key="jafarlouObjective2023"></d-cite>.</p> <p>I describe the methods used to achieve these goals, providing an overview of vector autoregression, Granger causality, and impulse response functions. I will detail the findings of these methods on the dataset, then conclude with a discussion of the methods and their potential applications in future work.</p> <h2 id="methods">Methods</h2> <h3 id="problem-setup">Problem setup</h3> <p>A multivariate time series analysis was performed using a vector autoregressive (VAR) model fit using ordinary least squares. An optimal lag order was first obtained using a combination of Akaike Information Criterion (AIC), Bayesian Information Criterion (BIC), Hannan-Quinn Information Criterion (HQIC), and final prediction error (FPE). After fitting a VAR(2) model on the multiple time series data (described below), a Granger causality test was performed in order to assess the predictive relationships between variables. Finally, an impulse response analysis was plotted to further explore the temporal relationships between variables, specifically between sleep and self-reported mood. I outline these analysis steps in greater detail in the sections that follow.</p> <h3 id="vector-autoregression">Vector Autoregression</h3> <p>A VAR($p$) model for a multivariate time series is a regression model for outcomes at time $t$ and time lagged predictors, with $p$ indicating the lag. Given $p$ = 1, the model would be concerned with one observation prior to $t$. A $T \times K$ multivariate time series (where $T$ is the number of observations and $K$ is the number of variables) can be modeled using a $p$-lag VAR model <d-cite key="lutkepohlNew2005"></d-cite>, notated as</p> \[Y_t = \nu + A_1 Y_{t-1} + \ldots + A_p Y_{t-p} + u_t\] \[u_t \sim {\sf Normal}(0, \Sigma_u)\] <p>where $A_i$ is a $K \times K$ coefficient matrix.</p> <p>Intercept terms are included in $\nu$ and regression coefficients are included as the subscripted $A$ values. This equation is solved using ordinary least squares (OLS) estimation. The vector autoregressive (VAR) model is a flexible method for the analysis of causality in this setting.</p> <h3 id="granger-causality-testing">Granger Causality Testing</h3> <p>I incorporated Granger causality tests to better assess the predictive capacity of the Oura sleep score on self-reported mood states. Granger causality defines one type of relationship between time series <d-cite key="grangerInvestigating1969"></d-cite> and states that a variable <em>Granger causes</em> another variable if “the prediction of one time series is improved by incorporating the knowledge of a second time series” <d-cite key="boseVector2017"></d-cite>.</p> <p>Two autoregressive models are fit to the first time series, once with and once without the inclusion of the second time series. The improvement of the prediction is measured as the ratio of variance of the error terms. The null hypothesis states that the first variable <em>does not</em> Granger cause the second variable and is rejected if the coefficients for the lagged values of the first variable are significant.</p> <p>In this study, Granger causation tests were applied using sleep scores as a single predictor and each mood state as outcome variables.</p> <h3 id="impulse-response-function-visualization">Impulse Response Function Visualization</h3> <p>An impulse response function (IRF) is the “reaction of a dynamic system in response to an external change” <d-cite key="devriesWearableMeasured2023"></d-cite>. Plotting an IRF allows for the interpretation of the impulse of a predictor on other variables on subsequent days. Given sleep scoring as a predictor, an IRF visualization (see below) was created to better understand its impact on mood state.</p> <h2 id="results">Results</h2> <h3 id="dataset-description">Dataset Description</h3> <p>The sleep score dataset was created using the second- and third-generation Oura Ring. The proprietary Oura sleep score is on a scale of 1 to 100 and incorporates a variety of sensor-based measures (i.e., heart rate variability, resting heart rate, body temperature) across time. Although the specifics of this algorithm are not public, the Oura Ring has been found to produce accurate measures of sleep timing and heart rate variability when compared against polysomnography <d-cite key="dezambottiSleep2019"></d-cite>. My use of the Oura Ring was consistent across time. The dataset contains 1,455 nights of sleep bout data occurring between February, 2019 and March, 2023.</p> <table> <thead> <tr> <th> </th> <th><strong>Value</strong></th> </tr> </thead> <tbody> <tr> <td>Total nights</td> <td>1455</td> </tr> <tr> <td>Missing nights</td> <td>1</td> </tr> <tr> <td>Mean</td> <td>73.82</td> </tr> <tr> <td>SD</td> <td>12.36</td> </tr> <tr> <td>Max</td> <td>97.00</td> </tr> <tr> <td>Min</td> <td>30.00</td> </tr> </tbody> </table> <p>Each day at 4:30pm I received a notification prompting me to log my subjective state in eMood Tracker, a mobile application for iOS. eMood Tracker is “recommended by psychologists, therapists, and social workers” and is intended to “track symptom data relating to Bipolar I and II disorders” <d-cite key="eMoods2023"></d-cite>. The version used through this period contains preset mood categories — depressed, irritable, anxious, and elevated. Users log the presence and intensity of each mood on a scale of 0 to 3, where 0 is “not present” and 3 is “severe”. The resulting dataset contains the most severe mood state per day as described below.</p> <table> <thead> <tr> <th><strong>EMA Categories</strong></th> <th><strong>Count</strong></th> </tr> </thead> <tbody> <tr> <td>irritable</td> <td>100</td> </tr> <tr> <td>anxious</td> <td>88</td> </tr> <tr> <td>depressed</td> <td>103</td> </tr> <tr> <td>elevated</td> <td>48</td> </tr> </tbody> </table> <h2 id="data-analysis">Data Analysis</h2> <p>All analysis were performed in Python version 3.11.0 using <code class="language-plaintext highlighter-rouge">pandas</code> 1.5.3 for data preprocessing and <code class="language-plaintext highlighter-rouge">statsmodels</code> 0.13.5 for modeling. Dickey-Fuller tests of stationarity were performed using <code class="language-plaintext highlighter-rouge">statsmodels</code> and the <code class="language-plaintext highlighter-rouge">pymdarima</code> library, a clone of R’s <code class="language-plaintext highlighter-rouge">auto.arima</code>.</p> <h3 id="stationarity-decomposition-and-autocorrelation">Stationarity, Decomposition, and Autocorrelation</h3> <p>A stationary time series contains no periodic fluctuation (“trend”). Without stationarity, the means and correlations given by a model will not accurately describe a time series’ true signal <d-cite key="boseVector2017"></d-cite>. If a time series is found not to be stationary, an approach known as differencing can be applied to achieve stationarity. The Dickey-Fuller test is one mechanism to determine whether a time series is stationary.</p> <p>Two Dickey-Fuller tests were performed on each time series, first via <code class="language-plaintext highlighter-rouge">statsmodels</code> and then, additionally, using <code class="language-plaintext highlighter-rouge">pymdarima</code>’s <code class="language-plaintext highlighter-rouge">should_diff()</code> function to assess the need for differencing. The <code class="language-plaintext highlighter-rouge">statsmodels</code> approach, an Augmented Dickey-Fuller test (ADF), yielded a significant $p$-value of .001 indicating support for the null hypothesis that the time series is not stationary. However, the ADF performed via the <code class="language-plaintext highlighter-rouge">pymdarima</code> approach using an alpha value of 0.05 yielded a non-significant $p$-value of 0.01 indicating that no differencing was required in order to produce a stationary time series. For the purposes of this study, I followed the results of the <code class="language-plaintext highlighter-rouge">pymdarima</code> library and assumed stationarity.</p> <p>I visualized a time series decomposition to better understand the presence of trend in the sleep score dataset.</p> <p><img src="/assets/img/decomposition.png" alt="" title="Decomposition of sleep time series"></p> <p>Additionally, I plotted a partial autocorrelation function using <code class="language-plaintext highlighter-rouge">statsmodels</code>. Notably, partial autocorrelation appears to drop to zero for lag values greater than 2.</p> <p><img src="/assets/img/pacf.png" alt="" title="Partial autocorrelation of sleep time series"></p> <h3 id="lag-order-selection">Lag Order Selection</h3> <p>The number of lags amount to the number of preceding days included as predictor values in the model. The <code class="language-plaintext highlighter-rouge">statsmodels</code> function <code class="language-plaintext highlighter-rouge">select_order()</code> was used to assess an optimal lag value with possibilities between 0 and 15. The optimal lag value was determined using four information criteria — Akaike Information Criteria (AIC), Bayes Information Criterion (BIC), Final Prediction Error (FPE), and Hannan-Quinn (HQ) criterion. This selection process yielded a tie with lag-1 and lag-2 each labeled as the minimum on these criteria. In this case, I selected lag-2 based on prior knowledge of sleep quality and the onset of mood states.</p> <table> <thead> <tr> <th> </th> <th><strong>AIC</strong></th> <th><strong>BIC</strong></th> <th><strong>FPE</strong></th> <th><strong>HQIC</strong></th> </tr> </thead> <tbody> <tr> <td><strong>0</strong></td> <td>1.688</td> <td>1.708</td> <td>5.408</td> <td>1.695</td> </tr> <tr> <td><strong>1</strong></td> <td>-0.02482</td> <td> <strong>0.09412</strong>*</td> <td>0.9755</td> <td> <strong>0.01979</strong>*</td> </tr> <tr> <td><strong>2</strong></td> <td> <strong>-0.03545</strong>*</td> <td>0.1826</td> <td> <strong>0.9652</strong>*</td> <td>0.04635</td> </tr> <tr> <td><strong>3</strong></td> <td>-0.03417</td> <td>0.2830</td> <td>0.9664</td> <td>0.08481</td> </tr> <tr> <td><strong>4</strong></td> <td>-0.02907</td> <td>0.3872</td> <td>0.9714</td> <td>0.1271</td> </tr> <tr> <td><strong>5</strong></td> <td>-0.02537</td> <td>0.4900</td> <td>0.9750</td> <td>0.1680</td> </tr> <tr> <td><strong>6</strong></td> <td>-0.01701</td> <td>0.5975</td> <td>0.9832</td> <td>0.2135</td> </tr> <tr> <td><strong>7</strong></td> <td>-0.01940</td> <td>0.6943</td> <td>0.9809</td> <td>0.2483</td> </tr> <tr> <td><strong>8</strong></td> <td>-0.01014</td> <td>0.8026</td> <td>0.9900</td> <td>0.2948</td> </tr> <tr> <td><strong>9</strong></td> <td>-0.0008049</td> <td>0.9111</td> <td>0.9993</td> <td>0.3413</td> </tr> <tr> <td><strong>10</strong></td> <td>0.01201</td> <td>1.023</td> <td>1.012</td> <td>0.3913</td> </tr> <tr> <td><strong>11</strong></td> <td>0.02510</td> <td>1.135</td> <td>1.026</td> <td>0.4415</td> </tr> <tr> <td><strong>12</strong></td> <td>0.03723</td> <td>1.246</td> <td>1.038</td> <td>0.4909</td> </tr> <tr> <td><strong>13</strong></td> <td>0.04867</td> <td>1.357</td> <td>1.050</td> <td>0.5395</td> </tr> <tr> <td><strong>14</strong></td> <td>0.06022</td> <td>1.468</td> <td>1.063</td> <td>0.5882</td> </tr> <tr> <td><strong>15</strong></td> <td>0.07076</td> <td>1.577</td> <td>1.074</td> <td>0.6359</td> </tr> </tbody> </table> <h3 id="vector-autoregression-model">Vector Autoregression Model</h3> <p>All time series under analysis were found to be stationary (ADF test $p$ &lt; .05). The results of the VAR(2) model predicting mood states using sleep score are shown below. <strong>Sleep score was found to be a significant positive predictor of depression, also confirmed via Granger causation tests</strong>. Sleep score did not positively or negatively predict other mood states in this model.</p> <table> <thead> <tr> <th> </th> <th><strong>Coefficient</strong></th> <th><strong>Std. error</strong></th> <th><strong>Test statistic</strong></th> <th><strong>p-value</strong></th> </tr> </thead> <tbody> <tr> <td><strong>L1.score</strong></td> <td>0.633262</td> <td>0.027574</td> <td>22.966</td> <td>0.000</td> </tr> <tr> <td><strong>L1.anxious</strong></td> <td>0.153275</td> <td>0.446110</td> <td>0.344</td> <td>0.731</td> </tr> <tr> <td><strong>L1.depressed</strong></td> <td>0.477164</td> <td>0.409130</td> <td>1.166</td> <td>0.243</td> </tr> <tr> <td><strong>L1.irritable</strong></td> <td>-0.282988</td> <td>0.412509</td> <td>-0.686</td> <td>0.493</td> </tr> <tr> <td><strong>L1.elevated</strong></td> <td>-0.220198</td> <td>0.655784</td> <td>-0.336</td> <td>0.737</td> </tr> <tr> <td><strong>L2.score</strong></td> <td>-0.003080</td> <td>0.027452</td> <td>-0.112</td> <td>0.911</td> </tr> <tr> <td><strong>L2.anxious</strong></td> <td>0.353528</td> <td>0.445359</td> <td>0.794</td> <td>0.427</td> </tr> <tr> <td><strong>L2.depressed</strong></td> <td><strong>1.241873</strong></td> <td>0.409667</td> <td><strong>3.031</strong></td> <td><strong>0.002</strong></td> </tr> <tr> <td><strong>L2.irritable</strong></td> <td>-0.080069</td> <td>0.412341</td> <td>-0.194</td> <td>0.846</td> </tr> <tr> <td><strong>L2.elevated</strong></td> <td>-0.499540</td> <td>0.657230</td> <td>-0.760</td> <td>0.447</td> </tr> </tbody> </table> <h3 id="granger-causality">Granger Causality</h3> <p>The results of the Granger causation tests are shown below. <strong>Sleep score was shown to Granger-cause both depressed and anxious mood.</strong></p> <table> <thead> <tr> <th><strong>Causal Variable</strong></th> <th><strong>Variable</strong></th> <th><strong>Test statistic</strong></th> <th><strong>Critical value</strong></th> <th><strong>p-value</strong></th> <th><strong>df</strong></th> </tr> </thead> <tbody> <tr> <td>sleepscore</td> <td><strong>depressed</strong></td> <td><strong>5.384</strong></td> <td>2.997</td> <td><strong>0.005</strong></td> <td>(2, 6535)</td> </tr> <tr> <td>sleepscore</td> <td><strong>anxious</strong></td> <td><strong>3.294</strong></td> <td>2.997</td> <td><strong>0.037</strong></td> <td>(2, 6535)</td> </tr> <tr> <td>sleepscore</td> <td>irritable</td> <td>1.347</td> <td>2.997</td> <td>0.260</td> <td>(2, 6535)</td> </tr> <tr> <td>sleepscore</td> <td>elevated</td> <td>1.203</td> <td>2.997</td> <td>0.500</td> <td>(2, 6535)</td> </tr> </tbody> </table> <h3 id="impulse-response-analysis">Impulse Response Analysis</h3> <p>As shown in the figure below, the impact of sleep score on the four self-reported mood states varies over a 10-day period. Standard errors are plotted at the 95% significance level. The effect of an impact on sleep score on depressed and anxious moods appear to be most felt only after several days of its impact, peaking at roughly 3 days and then gradually decaying.</p> <p><img src="/assets/img/IRF.png" alt="" title="Plot of Impulse Response Function, Lag 0 to 10"></p> <h2 id="discussion">Discussion</h2> <p>This exploratory study affirms the role that self-tracking technologies can play in the ongoing management of affective disorders. This type of N-of-1 analysis would be impossible without inexpensive wearable sensors, and the quality of this dataset is directly related to how non-invasive this particular wearable is.</p> <p>This work is limited in several ways. My reliance on an algorithmic ADF test to assess stationarity (rather than directly assessing the data myself) could leave room for error. Additionally, this work only assesses the influence of the Oura sleep score on mood. In reality, this is likely closer to a bidirectional influence and this should be reflected properly in the analysis.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Jeff Brozena. Last updated: February 24, 2025. </div> </footer> <d-bibliography src="/assets/bibliography/var.bib"></d-bibliography> <script async src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script async src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script async src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-JB8D6C8B0D"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JB8D6C8B0D");</script> </body> </html>